<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aurababy Leaderboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@800&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
    background: linear-gradient(to bottom, #002b80, #0044cc, #0066ff);
    color: white;
    text-align: center;
    padding: 50px 20px;
  }

  h1 { font-size: 2.5em; color: #00ffcc; margin-bottom: 20px; }

  #container {
    background: rgba(0,0,0,0.35);
    padding: 30px;
    border-radius: 15px;
    max-width: 500px;
    margin: 0 auto;
  }

  input { padding: 8px; border-radius: 6px; border: none; width: 70%; font-size: 1em; }
  button { padding: 8px 12px; border-radius: 6px; border: none; cursor: pointer; font-weight: 800; margin-left:5px; }

  #submitBtn { background: #00ffcc; color: black; }
  #updateBtn { background: #0072ff; color: white; margin-top: 10px; }
  #backBtn { background: #ff00aa; color: white; margin-top: 15px; }

  #leaderboard div {
    padding: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.2);
    display: flex;
    justify-content: space-between;
    font-size: 1.05em;
  }

  #leaderboard div:nth-child(1) { border-left: 5px solid gold; background: rgba(255,255,255,0.15); }
  #leaderboard div:nth-child(2) { border-left: 5px solid silver; background: rgba(255,255,255,0.1); }
  #leaderboard div:nth-child(3) { border-left: 5px solid #cd7f32; background: rgba(255,255,255,0.1); }
</style>
</head>

<body>
<h1>üèÜ Aurababy Leaderboard üèÜ</h1>
<div id="container">

  <div>
    <input type="text" id="usernameInput" placeholder="Enter your username">
    <button id="submitBtn">Submit</button>
  </div>
  <div id="message" style="margin-top:10px; min-height:20px;"></div>

  <button id="updateBtn">Check EXP</button>

  <div id="leaderboard" style="margin-top:20px;"></div>

  <button id="backBtn" onclick="window.location.href='index.html'">‚¨Ö Back to Game</button>
</div>

<script>
const apiBase = "https://leaderboardbackend-7cum.onrender.com";
let username = sessionStorage.getItem("aurababyUsername") || null;

// DOM elements
const usernameInput = document.getElementById("usernameInput");
const submitBtn = document.getElementById("submitBtn");
const message = document.getElementById("message");
const leaderboardEl = document.getElementById("leaderboard");
const updateBtn = document.getElementById("updateBtn");

// Lock username if already stored
if (username) {
  usernameInput.value = username;
  usernameInput.disabled = true;
  submitBtn.disabled = true;
  message.innerText = `Logged in as ${username}`;
}

// Submit username
submitBtn.onclick = () => {
  const name = usernameInput.value.trim();
  if (!name || name.length < 3 || name.length > 20) {
    message.innerText = "Username must be 3‚Äì20 characters.";
    return;
  }
  username = name;
  sessionStorage.setItem("aurababyUsername", username);
  usernameInput.disabled = true;
  submitBtn.disabled = true;
  message.innerText = `Logged in as ${username}`;
  updateLeaderboard();
};

// Fetch leaderboard
async function fetchLeaderboard() {
  try {
    const res = await fetch(`${apiBase}/leaderboard`);
    if (!res.ok) throw new Error("Failed to fetch");
    const data = await res.json();
    return data;
  } catch (err) {
    console.error(err);
    return [];
  }
}

// Submit current user EXP to backend
async function submitEXP() {
  if (!username) return;
  const exp = parseInt(localStorage.getItem("exp") || "0");
  try {
    await fetch(`${apiBase}/submit`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, exp })
    });
  } catch(err) {
    console.error(err);
  }
}

// Render top 5
async function updateLeaderboard() {
  if (!username) return;

  await submitEXP();

  let data = await fetchLeaderboard();
  data.sort((a,b) => b.exp - a.exp);

  leaderboardEl.innerHTML = "";
  for (let i=0; i<5; i++) {
    const div = document.createElement("div");
    if (i < data.length) {
      const u = data[i];
      div.innerHTML = `<strong>${i+1}. ${u.username}</strong> <span>${u.exp} EXP</span>`;
    } else {
      div.innerHTML = `<strong>${i+1}. ---</strong> <span>0 EXP</span>`;
    }
    leaderboardEl.appendChild(div);
  }
}

// Update button
updateBtn.onclick = updateLeaderboard;

// Auto-refresh every 10s
setInterval(updateLeaderboard, 10000);
</script>
</body>
</html>
