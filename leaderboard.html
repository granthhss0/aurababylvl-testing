<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aurababy Online Leaderboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@800&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(to bottom, #002b80, #0044cc, #0066ff);
  color: white;
  text-align: center;
  padding: 50px 20px;
}
h1 { font-size:2.5em; color:#00ffcc; margin-bottom:20px; }

#leaderboardContainer {
  background: rgba(0,0,0,0.35);
  padding:30px;
  border-radius:15px;
  max-width:600px;
  margin:0 auto;
}

input { padding:8px; border-radius:6px; border:none; margin:5px 0; width:70%; font-size:1em; }
button { padding:8px 12px; border-radius:6px; border:none; cursor:pointer; margin-left:5px; font-weight:800; }
#submitBtn{background:#00ffcc;color:black;}
.tabBtn{background:black;border:2px solid #00ffcc;color:#00ffcc;padding:8px 14px;margin:10px 5px;border-radius:8px;cursor:pointer;}
.tabBtn.active{background:#00ffcc;color:black;}
#leaderboard div{padding:10px;border-bottom:1px solid rgba(255,255,255,0.2);display:flex;justify-content:space-between;align-items:center;font-size:1.05em;}
#submitMsg{margin-top:8px;font-size:0.85em;min-height:20px;}
</style>
</head>
<body>

<h1>ðŸ“Š Aurababy Leaderboard ðŸ“Š</h1>
<div id="leaderboardContainer">
  <div>
    <input type="text" id="usernameInput" placeholder="Enter your username">
    <button id="submitBtn">Submit</button>
  </div>
  <div id="submitMsg"></div>

  <div style="margin-top:15px;">
    <button class="tabBtn active" id="expTab">EXP</button>
    <button class="tabBtn" id="timeTab">Time</button>
  </div>

  <div style="margin-top:15px;">
    <input type="text" id="filterInput" placeholder="Filter by usernameâ€¦">
  </div>

  <div id="leaderboard" style="margin-top:20px;"></div>
</div>

<script>
const leaderboardEl = document.getElementById("leaderboard");
const usernameInput = document.getElementById("usernameInput");
const submitBtn = document.getElementById("submitBtn");
const submitMsg = document.getElementById("submitMsg");
const filterInput = document.getElementById("filterInput");
const expTab = document.getElementById("expTab");
const timeTab = document.getElementById("timeTab");

let currentTab = "exp";

// Helpers
function niceNum(n){ return n.toLocaleString(); }
function niceTime(t){ return (t||0) + "s"; }

async function fetchLeaderboard() {
  try {
    const res = await fetch("https://leaderboardbackend-7cum.onrender.com/leaderboard");
    if (!res.ok) throw new Error("Failed to fetch leaderboard");
    const data = await res.json();
    return data;
  } catch(e) {
    console.error(e);
    return [];
  }
}

async function submitScore() {
  const username = usernameInput.value.trim();
  if (!username || username.length < 3 || username.length > 20) {
    submitMsg.innerText = "Username must be 3â€“20 characters.";
    return;
  }

  const exp = parseInt(localStorage.getItem("exp") || "0");
  const time = parseInt(localStorage.getItem("totalSeconds") || "0");

  if (exp <=0 && time <=0) {
    submitMsg.innerText = "You must earn EXP or TIME before submitting.";
    return;
  }

  try {
    const res = await fetch("https://leaderboardbackend-7cum.onrender.com/submit", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ username, exp, time })
    });
    const data = await res.json();
    if (data.success) {
      submitMsg.innerText = `Saved! EXP: ${niceNum(exp)}, Time: ${niceTime(time)}`;
      renderLeaderboard();
    } else {
      submitMsg.innerText = "Error submitting score.";
    }
  } catch(e) {
    console.error(e);
    submitMsg.innerText = "Failed to submit score.";
  }
}

async function renderLeaderboard() {
  let data = await fetchLeaderboard();
  const filter = (filterInput.value||"").toLowerCase();
  if (filter) data = data.filter(u => u.username.toLowerCase().includes(filter));
  if (currentTab === "exp") data.sort((a,b)=>b.exp-a.exp);
  else data.sort((a,b)=>b.time-b.time);

  leaderboardEl.innerHTML = "";
  for(let i=0;i<5;i++){
    const div = document.createElement("div");
    if(i<data.length){
      const u = data[i];
      div.innerHTML = `<strong>${i+1}. ${u.username}</strong> <span>${niceNum(u.exp)} EXP â€¢ ${niceTime(u.time)}</span>`;
    } else {
      div.innerHTML = `<strong>${i+1}. ---</strong> <span>0 EXP â€¢ 0s</span>`;
    }
    leaderboardEl.appendChild(div);
  }
}

// Event listeners
submitBtn.addEventListener("click", submitScore);
filterInput.addEventListener("input", ()=>setTimeout(renderLeaderboard,200));

expTab.onclick = ()=>{
  currentTab="exp";
  expTab.classList.add("active");
  timeTab.classList.remove("active");
  renderLeaderboard();
};
timeTab.onclick = ()=>{
  currentTab="time";
  timeTab.classList.add("active");
  expTab.classList.remove("active");
  renderLeaderboard();
};

// Auto-refresh every 5s
setInterval(renderLeaderboard,5000);

// Initial render
renderLeaderboard();
</script>

</body>
</html>
